<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">	
    <title>Pandino Il Panino</title>
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="description" content="">
    <meta name="author" content="Alessio Morganti">
	<link rel="stylesheet" href="css/idangerous.swiper.css">
	<link rel="stylesheet" href="css/idangerous.swiper.scrollbar.css">

    <style>
        body {
			width: 100%;
            height: 100%;
			margin:0;
			overflow:hidden;
            font-size: 1em;
			background:#baaca6;		            
        }
		
		#sfondo {
			position:absolute;
			top:0;
			left:0;
			right:0;
			bottom:0;
			width:100%;
			height:100%;
			overflow:hidden;
			display:block;
			/*background:#000 url(img/loader.gif) center center no-repeat;*/
		}
		
		#riprova {
			position:absolute;			
			left:10px;
			right:10px;
			bottom:0;
			height:auto;
			overflow:hidden;
			display:none;
			background:#333;
			color:#fff;
			text-align:center;
			padding:20px;
			cursor:pointer;
		}
		
		#pagina {
			position:absolute;
			top:0;
			left:0;
			right:0;
			bottom:0;
			width:100%;
			height:100%;
			overflow:hidden;
			display:none;
		}
		
		#header {
			position:absolute;
			top:0;
			left:0;
			right:0;
			background:#000 url(img/logo.png) top left no-repeat;
			border-bottom:2px solid #fff;
		}
		
		#header h1{
			margin:0 auto;
			text-align:center;
			font-size:1em;
			color:#fff;
			padding:0;
		}
		
		#main {
			position:absolute;
			top:0;
			left:0;
			right:0;
		}
		
		#main .notizia{
			position:relative;
			top:0;
			left:0;
			right:0;
			border-bottom:1px solid #ccc;
			text-align:center;
		}
		
		#main .notizia img{
			height:100%;
			width:auto;
		}
		
		#footer {
			position:absolute;
			bottom:0;
			left:0;
			right:0;
			background:#ff0; 
		}
		
		.pmenu {
			position:relative;
			border-top:2px solid #fff;
			background: #000;
			color:#fff;
		}
		
		.pmenu:hover {			
			background: #fff;
			color:#000;
		}
		
		.pmenu h4 {
			margin:0 auto;
			text-align:center;
		}
		
		.loader {
			background:#000 url(img/loader.gif) center center no-repeat;
		}
		
		.errore {
			background:#000 url(img/errore.png) center center no-repeat;
		}		
		
		/* SCROLLBAR PERSONALIZZAZIONI */
		.mCSB_container{
			width:100%;
		}
    </style>
	<script src="js/jquery-1.9.1.min.js"></script>
	<script src="js/idangerous.swiper-2.1.min.js"></script>
	<script src="js/idangerous.swiper.scrollbar-2.1.js"></script>
</head>
<body>
	<div id="sfondo" class="loader">
	</div>
	<div id="riprova">
		RIPROVA
	</div>
	<div id="pagina">
		<div id="header">
			<h1>NEWS</h1>
		</div>
		
		<div id="main" class="swiper-container">
			<div class="swiper-wrapper">
				
			</div>
		</div>
		<div class="swiper-scrollbar"></div>
		
		<div id="footer">
			<div class="pmenu"><h4>GALLERY</h4></div>
			<div class="pmenu"><h4>MAPPA</h4></div>
			<div class="pmenu"><h4>PRENOTA</h4></div>
		</div>
	</div>
    <script>
	
	function appInizia() {
		
		var urlJsonp = 'http://www.massimoabbondi.it/apps/pandino/data/jsonp.php';
		
		function jsonpCallback(response){
			$('#main .swiper-wrapper').append(response);
			var hUnit = 0;
			var hMain = 0;
			hUnit = Math.ceil($(window).height()/14);
			hMain = $(window).height() - hUnit*5 - 2;
			$('#header').css({'height': hUnit *2 + 'px'});
			$('#header').css({'background-size':  hUnit *2 + 'px auto'});
			$('#header h1').css({'line-height': hUnit*2 + 'px'});
			$('#main').css({'top':  hUnit *2 + 2 + 'px', 'height': hMain + 'px'});
			$('#main .notizia').css({'height': Math.ceil(hMain/3) + 'px'});
			$('#footer').css({'height': hUnit *3 + 6 + 'px'});
			$('.pmenu').css({'height': hUnit + 'px'});
			$('.pmenu h4').css({'line-height': hUnit + 'px'});		
			
			$('#sfondo').css('display','none');
			$('#pagina').css('display','block');
			
			
			var mySwiper = new Swiper('.swiper-container',{
				slidesPerView: 3,
				slidesPerGroup:3,
				mode:'vertical',
				momentumBounce:false,
  
			});			
			

			
			/*
			$('#main').mCustomScrollbar({
				horizontalScroll:false,
				autoHideScrollbar:true,
				autoDraggerLength: false,
				scrollInertia: 10,
				theme:"light-thin"
			});	
			*/			
			//$('#main').mCustomScrollbar('update');
			
			
		}
		
		$.ajax({
			url: urlJsonp,
			dataType: 'jsonp',
			error: function(xhr, status, error) {
					//alert(error);
					},
			success: jsonpCallback			
		});
		
	};
	
	
	function riprova() {
		$('#riprova').css('display','none');
		$('#sfondo').removeClass('errore');
		testConn();
	}

	function doConnectFunction() {
		//alert('sei connesso');
		// carico i contenuti;		
		appInizia();
	}
	
	function doNotConnectFunction() {
		$('#sfondo').addClass('errore');
		//alert('ATTENZIONE: non sei connesso');
		$('#riprova').css('display','block');
		$('#riprova').click(function() {riprova();});
	}
	
	function testConn() {
		var i = new Image();
		i.onload = doConnectFunction;
		i.onerror = doNotConnectFunction;
		// IMMAGINE DI TEST
		i.src = 'http://www.massimoabbondi.it/apps/test.gif?d=' + escape(Date());
	}
		
    $(document).ready(function() {		
		testConn();
	});
  
    </script>
</body>
</html>